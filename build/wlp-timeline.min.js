!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.wlp_timeline={})}(this,function(t){"use strict";function e(){function t(t,e){for(var n=[],r=new Date(t.getTime());e>=r;r.setDate(r.getDate()+1))n.push({startTime:new Date(r.getFullYear(),r.getMonth(),r.getDate(),18,0,0),endTime:new Date(r.getFullYear(),r.getMonth(),r.getDate()+1,6,0,0)});return n}return{nighttimeEvents:t}}function n(t,e,n,r,a,i,o,s){return d3.time.format.multi([[t,function(t){return t.getMilliseconds()}],[e,function(t){return t.getSeconds()}],[n,function(t){return t.getMinutes()}],[r,function(t){return t.getHours()}],[a,function(t){return t.getDay()&&1!=t.getDate()}],[i,function(t){return 1!=t.getDate()}],[o,function(t){return t.getMonth()}],[s,function(){return!0}]])}function r(t,e,n,r,a){return d3.svg.axis().scale(t).tickFormat(e).orient(n).tickSize(r).tickPadding(a)}function a(t,e,n){var r=n?'style="color:#fff; background-color: rgba(255, 0, 0, 0.7);"':'style="color:#fff;"',a=""==t?"":":";return"<tr><td>"+t+a+'</td><td colspan="4" class="tabcol1"'+r+">"+e+"</td></tr>"}function i(t,e){_=d3.time.scale().domain([t,e]).range([0,w]);var a=n(".%L",":%S","%_I:%M","%_I %p","%b %-d","%b %-d","%b","%Y"),i=n(" "," "," "," ","%a","%a","%a"," ");T=r(_,a,"bottom",-L,6),E=r(_,i,"bottom",-L,18),M=r(_,"","bottom",-L,0).ticks(d3.time.days,1),z=r(_,"","bottom",-L,0).ticks(d3.time.weeks,1),Y=r(_,"","bottom",0,0).ticks(d3.time.years,1)}function o(){var t=_.invert(0),e=_.invert(w);return(e.getTime()-t.getTime())/1e3/3600/24}function s(t,e,n){n>0&&o()>n?D.select(t).call(Y):D.select(t).call(e)}function c(){m(),I&&h(),s(".x.axisMain",T,0),s(".x.axis-day-names",E,60),s(".x.axis-days",M,60),s(".x.axis-weeks",z,60)}function l(t,e,n){t.append("g").attr("class",e).attr("transform","translate(0,"+n+")")}function u(t,e){w=e-H.left-H.right;var n=new Date,r=new Date(n.getTime()-864e5),a=new Date(n.getTime()+864e5);i(r,a),A=d3.behavior.zoom().x(_).scaleExtent([-3e3,3e3]).on("zoom",function(){c()});var o=20;d3.select(t).style("font-family","Avenir").style("font-size","10px").style("top",o+"px").style("bottom",o+"px").style("left",o+"px").style("right",o+"px").style("position","absolute"),y=d3.select(t).append("svg").attr("width",w+H.left+H.right).attr("height",L+H.top/2+H.bottom),D=y.append("g").attr("pointer-events","none").attr("transform","translate("+H.left+","+H.top/2+")"),l(D,"x axisMain",L),l(D,"x axis-day-names",L),l(D,"x axis-days",L),l(D,"x axis-weeks",L),b=y.append("svg").attr("vector-effect","non-scaling-stroke").attr("width",w).attr("height",L).attr("x",H.left).attr("y",H.top/2).attr("viewBox","0 0 "+w+" "+L).call(A).call(q),S=B.nighttimeEvents(r,a),j=b.append("g"),c(),b.append("rect").attr("fill","white").attr("fill-opacity",0).attr("width",w).attr("height",L).attr("class","innertimelinebackground"),k=y.append("g").attr("pointer-events","none").attr("transform","translate("+H.left+","+H.top/2+")"),k.append("rect").attr("fill","white").attr("fill-opacity",0).attr("width",w).attr("height",L).attr("stroke","#eee").attr("stroke-width",3).attr("class","outertimelinebackground")}function f(t){return t.attr("height",L).attr("class","nightrect")}function d(t){t.attr("y",0).attr("x",function(t){return _(t.startTime)}).attr("width",function(t){return _(t.endTime)-_(t.startTime)})}function m(){var t;t=o()>14?[]:S;var e=j.selectAll("rect.nightrect").data(t);f(e.enter().append("rect")),d(e),e.exit().remove()}function p(t){return t.on("mouseover",function(t){return q.show(t)}).attr("r",5).attr("fill","#555")}function g(t){t.attr("cy",L/2).attr("cx",function(t){return _(t)}).on("mouseover",function(t){return q.show(t)}).on("mouseleave",function(t){return q.hide(t)}).on("click",function(t){var e=new Date(t.getTime()-432e5),n=new Date(t.getTime()+432e5);v([e,n])})}function h(){var t=F.selectAll("circle").data(I);p(t.enter().append("circle")),g(t),t.exit().remove()}function x(t){I=t,F=b.append("g");var e=d3.extent(t);S=B.nighttimeEvents(e[0],e[1]),h(),v(e)}function v(t){d3.transition().duration(500).tween("zoom",function(){var e=d3.interpolate(_.domain(),t);return function(t){A.x(_.domain(e(t))),c()}})}var w,y,b,k,D,T,M,z,E,Y,_,A,F,I,S,j,B=e(),H={top:20,right:20,bottom:30,left:20},L=70-H.top-H.bottom,P=d3.time.format("%a %b %e, %Y at %_I:%M %p"),q=d3.tip().attr("class","d3-tip").offset([-7,0]).html(function(t){return'<table class="tooltiptable">'+a("time",P(t),!1)+"</table>"}),C="0.0.1";t.version=C,t.drawTimeline=u,t.addData=x,t.viewModel=e});