!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define("wlp-timeline",["exports"],e):e(t.wlp_timeline={})}(this,function(t){"use strict";function e(){function t(t,e){for(var n=[],i=new Date(t.getTime());e>=i;i.setDate(i.getDate()+1))n.push({startTime:new Date(i.getFullYear(),i.getMonth(),i.getDate(),18,0,0),endTime:new Date(i.getFullYear(),i.getMonth(),i.getDate()+1,6,0,0)});return n}return{nighttimeEvents:t}}function n(t,e,n,i,a,r,o,s){return d3.time.format.multi([[t,function(t){return t.getMilliseconds()}],[e,function(t){return t.getSeconds()}],[n,function(t){return t.getMinutes()}],[i,function(t){return t.getHours()}],[a,function(t){return t.getDay()&&1!=t.getDate()}],[r,function(t){return 1!=t.getDate()}],[o,function(t){return t.getMonth()}],[s,function(){return!0}]])}function i(t,e,n,i,a){return d3.svg.axis().scale(t).tickFormat(e).orient(n).tickSize(i).tickPadding(a)}function a(t,e){A=d3.time.scale().domain([t,e]).range([0,v]);var a=n(".%L",":%S","%_I:%M","%_I %p","%b %-d","%b %-d","%b","%Y"),r=n(" "," "," "," ","%a","%a","%a"," ");k=i(A,a,"bottom",-H,6),z=i(A,r,"bottom",-H,18),T=i(A,"","bottom",-H,0).ticks(d3.time.days,1),M=i(A,"","bottom",-H,0).ticks(d3.time.weeks,1),E=i(A,"","bottom",0,0).ticks(d3.time.years,1)}function r(){var t=A.invert(0),e=A.invert(v);return(e.getTime()-t.getTime())/1e3/3600/24}function o(t,e,n){n>0&&r()>n?D.select(t).call(E):D.select(t).call(e)}function s(){d(),Y&&g(),o(".x.axisMain",k,0),o(".x.axis-day-names",z,60),o(".x.axis-days",T,60),o(".x.axis-weeks",M,60)}function c(t,e,n){t.append("g").attr("class",e).attr("transform","translate(0,"+n+")")}function l(t,e){v=e-B.left-B.right;var n=new Date,i=new Date(n.getTime()-864e5),r=new Date(n.getTime()+864e5);a(i,r),F=d3.behavior.zoom().x(A).scaleExtent([-3e3,3e3]).on("zoom",function(){s()});var o=20;d3.select(t).style("font-family","Avenir").style("font-size","10px").style("top",o+"px").style("bottom",o+"px").style("left",o+"px").style("right",o+"px").style("position","absolute"),w=d3.select(t).append("svg").attr("width",v+B.left+B.right).attr("height",H+B.top/2+B.bottom),D=w.append("g").attr("pointer-events","none").attr("transform","translate("+B.left+","+B.top/2+")"),c(D,"x axisMain",H),c(D,"x axis-day-names",H),c(D,"x axis-days",H),c(D,"x axis-weeks",H),y=w.append("svg").attr("vector-effect","non-scaling-stroke").attr("width",v).attr("height",H).attr("x",B.left).attr("y",B.top/2).attr("viewBox","0 0 "+v+" "+H).call(F),_=j.nighttimeEvents(i,r),I=y.append("g"),s(),y.append("rect").attr("fill","white").attr("fill-opacity",0).attr("width",v).attr("height",H).attr("class","innertimelinebackground"),b=w.append("g").attr("pointer-events","none").attr("transform","translate("+B.left+","+B.top/2+")"),b.append("rect").attr("fill","white").attr("fill-opacity",0).attr("width",v).attr("height",H).attr("stroke","#eee").attr("stroke-width",3).attr("class","outertimelinebackground")}function u(t){return t.attr("height",H).attr("class","nightrect")}function f(t){t.attr("y",0).attr("x",function(t){return A(t.startTime)}).attr("width",function(t){return A(t.endTime)-A(t.startTime)})}function d(){var t;t=r()>14?[]:_;var e=I.selectAll("rect.nightrect").data(t);u(e.enter().append("rect")),f(e),e.exit().remove()}function m(t){return t.attr("r",5).attr("fill","#555")}function p(t){t.attr("cy",H/2).attr("cx",function(t){return A(t)}).on("click",function(t){var e=new Date(t.getTime()-432e5),n=new Date(t.getTime()+432e5);h([e,n])})}function g(){var t=S.selectAll("circle").data(Y);m(t.enter().append("circle")),p(t),t.exit().remove()}function x(t){Y=t,S=y.append("g");var e=d3.extent(t);_=j.nighttimeEvents(e[0],e[1]),g(),h(e)}function h(t){d3.transition().duration(500).tween("zoom",function(){var e=d3.interpolate(A.domain(),t);return function(t){F.x(A.domain(e(t))),s()}})}var v,w,y,b,D,k,T,M,z,E,A,F,S,Y,_,I,j=e(),B={top:20,right:20,bottom:30,left:20},H=70-B.top-B.bottom,L="0.0.1";t.version=L,t.drawTimeline=l,t.addData=x,t.viewModel=e});